<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroids</title>
  </head>
  <style>
    html, body {
      margin: 20px;
      width: 500px;
    }
    #myCanvas {
      background-color: black; 
      <!-- width: 100vw; -->
      border: 2px solid red;
    }
  </style>
  <script>
    document.addEventListener("DOMContentLoaded", (event) => { 
      const canvas = document.getElementById("myCanvas");
      const ctx = canvas.getContext("2d");

      // Variables
      var accel = 0;
      var vel = 0;
      var shipX = canvas.width / 2;
      var shipY = canvas.height / 2;
      var rotation = 0;
      var gameLoop = true;
      var starCount = 50;
      const starsPos = [];

      // Game Screen
      for (var i = 0; i < starCount; ++i) {
        x = Math.floor(Math.random() * canvas.width);
        y = Math.floor(Math.random() * canvas.height); 
        starsPos[i] = {x: x, y: y}
      }

      // Add rotation
      function drawShip(x, y, d, v) {
        console.log("")
        ctx.save();
        ctx.translate(x, y + 16);
        ctx.rotate((d * Math.PI) / 180);
        ctx.translate(-x, -(y + 16));

        ctx.beginPath();
        var nx = x + v * Math.sin((d * Math.PI) / 180);
        var ny = y - v * Math.cos((d * Math.PI) / 180);
        shipX = nx;
        shipY = ny;
        console.log("x: " + x + ", y: " + y + ", nx: " + nx + ", ny: " + ny)

//         x' = x * cos(θ) - y * sin(θ)
//         y' = x * sin(θ) + y * cos(θ) 

        ctx.moveTo(x, y);
        ctx.lineTo(x - 8, y + 32);
        ctx.lineTo(x + 8, y + 32);
        ctx.lineTo(x, y);
        ctx.strokeStyle = "white";
        ctx.lineWidth = 2;

        ctx.stroke(); 
        ctx.fillStyle = "black";
        ctx.fill();

        ctx.closePath();
        //
        // ctx.translate(x, y);
        // ctx.rotate((-d * Math.PI) / 180);
        // ctx.translate(-x, -y);
        ctx.restore();
      }

      function drawGame() {
        for (const pos of starsPos) {
          ctx.fillStyle = "white";
          ctx.fillRect(pos.x, pos.y, 2, 2);
        }
      }

      // Add more key events
      document.addEventListener("keydown", (event) => { 
        switch (event.key) {
          case "ArrowUp": accel = accel + 0.05;
            break;
          case "ArrowRight": rotation = (rotation + 5) % 360;
            break;
          case "ArrowLeft": rotation = (rotation - 5) % 360
            break;
        }
      });

      document.addEventListener("keyup", (event) => { 
        console.log(event.key);
        switch (event.key) {
          case "ArrowUp": accel = 0;
        }
      });

      // Game Loop
      const interval = setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGame();
        var friction = 0.02;
        vel = Math.max(vel + accel - friction, 0);
        console.log("shipX: " + shipX + ", shipY: " + shipY + ", vel: " + vel + ", accel: " + accel)
        drawShip(shipX, shipY, rotation, vel); 
      }, 10);

    });
  </script>
  <body>
    <canvas id="myCanvas" width="800" height="800"></canvas>
  </body>
</html>
